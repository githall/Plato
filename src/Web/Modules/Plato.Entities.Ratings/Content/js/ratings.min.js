if(typeof jQuery=="undefined")throw new Error("jQuery 3.3.1 or above Required");if(typeof window.$.Plato=="undefined")throw new Error("$.Plato Required");if(typeof window.$.fn.platoUI=="undefined")throw new Error("$.Plato UI Required");$(function(n,t,i){"use strict";var r=n.$.Plato,u=function(){var t="rating",f=t+"Id",e={event:"click",params:{rating:0,entityId:0,entityReplyId:0},onUpdated:function(){}},u={_loading:!1,init:function(n,t){if(t){this[t]?this[t].apply(this,[n]):alert(t+" is not a valid method!");return}u.bind(n)},bind:function(n){n.find("a").each(function(){var r=n.data(t).event;r&&i(this).unbind(r).bind(r,function(r){var f=parseInt(i(this).attr("data-rating"));isNaN(f)||(r.preventDefault(),n.data(t).params.rating=f,u.post(n))})})},unbind:function(n){n.find("a").each(function(){var r=n.data(t).tooltipEvent;r&&i(this).unbind(r);r=n.data(t).event;r&&i(this).unbind(r)})},post:function(n){if(!u._loading){u._loading=!0;var i=n.data(t).params;i.entityId=this.getEntityId(n);i.entityReplyId=this.getEntityReplyId(n);r.http({url:u.getUrl(n),method:"POST",data:JSON.stringify(i)}).done(function(i){if((i.statusCode===201||i.statusCode===202)&&(u._loading=!1,n.data(t).onUpdated))n.data(t).onUpdated(n,i.result)})}},getUrl:function(t){return t.attr("data-rating-url")&&t.attr("data-rating-url")!==""?t.attr("data-rating-url"):n.$.Plato.defaults.pathBase+"/api/ratings/rate/post"},getEntityId:function(n){var t=0;if(n.attr("data-entity-id")&&(t=parseInt(n.attr("data-entity-id"))),t===0)throw new Error("A entity id is required in order to rate an entity");return t},getEntityReplyId:function(n){var t=0;return n.attr("data-entity-reply-id")&&(t=parseInt(n.attr("data-entity-reply-id"))),t}};return{init:function(){for(var r,h,o={},n=null,s=0;s<arguments.length;++s)if(r=arguments[s],r)switch(r.constructor){case Object:i.extend(o,r);break;case String:n=r}if(this.length>0)return this.each(function(){if(i(this).data(f))i(this).data(t,i.extend({},i(this).data(t),o));else{var r=t+parseInt(Math.random()*100)+(new Date).getTime();i(this).data(f,r);i(this).data(t,i.extend({},e,o))}u.init(i(this),n)});n&&(u[n]?(h=i("body"),h.data(t,i.extend({},e,o)),u[n].apply(this,[h])):alert(n+" is not a valid method!"))}}}(),f=function(n){var t="voteToggle",e=t+"Id",f={},u={init:function(n,t){if(t){this[t]?this[t].apply(this,[n]):alert(t+" is not a valid method!");return}u.bind(n)},bind:function(t){t.rating(i.extend({onUpdated:function(n,t){var i=n.find("h6"),u;if(i.length>0){if(u=t.totalRatings,u!==null&&typeof u!="undefined"){var f=r.T("Based on {0}"),e=r.T("vote"),o=r.T("votes"),s=u===1?u+" "+e:u+" "+o;f=f.replace("{0}",s);i.attr("title")&&i.attr("title",f);i.attr("data-original-title")&&i.attr("data-original-title",f)}i.empty().text(t.summedRating)}}},f,n))},unbind:function(n){n.rating("unbind")}};return{init:function(){for(var r,h,o={},n=null,s=0;s<arguments.length;++s)if(r=arguments[s],r)switch(r.constructor){case Object:i.extend(o,r);break;case String:n=r}if(this.length>0)return this.each(function(){if(i(this).data(e))i(this).data(t,i.extend({},i(this).data(t),o));else{var r=t+parseInt(Math.random()*100)+(new Date).getTime();i(this).data(e,r);i(this).data(t,i.extend({},f,o))}u.init(i(this),n)});n&&(u[n]?(h=i("body"),h.data(t,i.extend({},f,o)),u[n].apply(this,[h])):alert(n+" is not a valid method!"))}}}();i.fn.extend({rating:u.init,voteToggle:f.init});r.ready(function(){i('[data-provide="rating"]').rating();i('[data-provide="vote-toggle"]').voteToggle()});i().infiniteScroll(function(n){n.find('[data-provide="rating"]').rating();n.find('[data-provide="vote-toggle"]').voteToggle()},"ready")}(window,document,jQuery));