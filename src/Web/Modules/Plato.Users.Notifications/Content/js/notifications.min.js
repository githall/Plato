if(typeof jQuery=="undefined")throw new Error("Plato requires jQuery");if(typeof window.$.Plato=="undefined")throw new Error("$.Plato Required");if(typeof window.$.fn.platoUI=="undefined")throw new Error("$.Plato UI Required");$(function(n,t,i){"use strict";var r=n.$.Plato,u=function(){var t="notifications",f=t+"Id",e={},u={init:function(n,t){if(t){this[t]?this[t].apply(this,[n]):alert(t+" is not a valid method!");return}this.bind(n)},bind:function(t){var f=r.T("Delete Notification");t.pagedList({page:1,pageSize:5,enablePaging:!1,itemSelection:{enable:!1,index:0,css:"active"},noResultsIcon:null,noResultsText:r.T("No notifications at this time"),config:{method:"GET",url:n.$.Plato.defaults.pathBase+"/api/notifications/user/get?page={page}&size={pageSize}",data:{sort:"CreatedDate",order:"Desc"}},itemCss:"dropdown-item p-2",itemTemplate:'<a id="notification{id}" class="{itemCss}" href="{url}"><span class="list-left"><span class="avatar mt-1 mr-2" data-toggle="tooltip" title="{from.displayName}"><span style="background-image: url({from.avatar.url});"><\/span><\/span><\/span><span class="list-body"><span class="float-right text-muted notification-date">{date.text}<\/span><span class="float-right p-2 notification-dismiss" title="{Delete}" data-notification-id="{id}"><i class="fal fa-times"><\/i><\/span><h6 style="max-width: 300px; white-space:nowrap; overflow:hidden; text-overflow: ellipsis;">{title}<\/h6>{message}<\/span><\/a>',parseItemTemplate:function(n,t){return n=n.replace(/\{Delete}/g,f),n=t.id?n.replace(/\{id}/g,t.id):n.replace(/\{id}/g,"0"),n=t.to.id?n.replace(/\{to.Id}/g,t.to.id):n.replace(/\{to.Id}/g,""),n=t.to.displayName?n.replace(/\{to.displayName}/g,t.to.displayName):n.replace(/\{to.displayName}/g,""),n=t.to.userName?n.replace(/\{to.userName}/g,t.to.userName):n.replace(/\{to.userName}/g,""),n=t.to.url?n.replace(/\{to.url}/g,t.to.url):n.replace(/\{to.url}/g,""),n=t.to.avatar.url?n.replace(/\{to.avatar.url}/g,t.to.avatar.url):n.replace(/\{to.avatar.url}/g,""),n=t.from.id?n.replace(/\{from.id}/g,t.from.id):n.replace(/\{from.id}/g,""),n=t.from.displayName?n.replace(/\{from.displayName}/g,t.from.displayName):n.replace(/\{from.displayName}/g,""),n=t.from.userName?n.replace(/\{from.userName}/g,t.from.userName):n.replace(/\{from.userName}/g,""),n=t.from.url?n.replace(/\{from.url}/g,t.from.url):n.replace(/\{from.url}/g,""),n=t.from.avatar.url?n.replace(/\{from.avatar.url}/g,t.from.avatar.url):n.replace(/\{from.avatar.url}/g,""),n=t.title?n.replace(/\{title}/g,t.title):n.replace(/\{title}/g,""),n=t.message?n.replace(/\{message}/g,t.message):n.replace(/\{message}/g,""),n=t.date.text?n.replace(/\{date.text}/g,t.date.text):n.replace(/\{date.text}/g,""),n=t.date.value?n.replace(/\{date.value}/g,t.date.value):n.replace(/\{date.value}/g,""),t.url?n.replace(/\{url}/g,t.url):n.replace(/\{url}/g,"#")},onLoaded:function(t){var f=i(".notification-dismiss");t.find('[data-toggle="tooltip"]').tooltip({trigger:"hover"});f.each(function(){i(this).click(function(f){f.preventDefault();f.stopPropagation();i(this).tooltip("hide");var e=i(this).attr("data-notification-id"),o=t.find("#notification"+e);o.slideUp("fast",function(){e!==null&&(e<=0||r.http({method:"DELETE",url:n.$.Plato.defaults.pathBase+"/api/notifications/user/delete?id="+e}).done(function(n){n.statusCode===200&&u.update(t)}))})})})}})},update:function(n){n.pagedList("bind")}};return{init:function(){for(var r,h,o={},n=null,s=0;s<arguments.length;++s)if(r=arguments[s],r)switch(r.constructor){case Object:i.extend(o,r);break;case String:n=r}if(this.length>0)return this.each(function(){if(i(this).data(f))i(this).data(t,i.extend({},i(this).data(t),o));else{var r=t+parseInt(Math.random()*100)+(new Date).getTime();i(this).data(f,r);i(this).data(t,i.extend({},e,o))}u.init(i(this),n)});n&&(u[n]?(h=i("body"),h.data(t,i.extend({},e,o)),u[n].apply(this,[h])):alert(n+" is not a valid method!"))}}}(),f=function(){var t="notificationsBadge",f=t+"Id",e={onShow:null,onHide:null,count:0,prevCount:-1,onPollComplete:null,pollInterval:120},u={init:function(n,t){if(t){this[t]?this[t].apply(this,[n]):alert(t+" is not a valid method!");return}this.bind(n)},bind:function(i){u.poll(i);var r=i.data(t).pollInterval;r>0&&n.setInterval(function(){u.poll(i)},r*1e3)},poll:function(i){if(r===null)throw new Error("$.Plato Required");r.logger&&r.logger.logInfo("Polling user notifications");r.http({url:n.$.Plato.defaults.pathBase+"/api/notifications/user/unread",method:"GET"}).done(function(n){if(n.statusCode===200&&(r.logger&&r.logger.logInfo("Successfully polled user notifications"),i.data(t).onPollComplete))i.data(t).onPollComplete(i,n.result)})},show:function(n){if(n.text(n.data(t).count.toString()),n.hasClass("hidden")&&n.removeClass("hidden"),n.hasClass("show")||n.addClass("show"),n.data(t).onShow)n.data(t).onShow(n)},hide:function(n){if(n.hasClass("show")&&n.removeClass("show"),n.hasClass("hidden")||n.addClass("hidden"),n.data(t).onHide)n.data(t).onHide(n)}};return{init:function(){for(var r,h,o={},n=null,s=0;s<arguments.length;++s)if(r=arguments[s],r)switch(r.constructor){case Object:i.extend(o,r);break;case String:n=r}if(this.length>0)return this.each(function(){if(i(this).data(f))i(this).data(t,i.extend({},i(this).data(t),o));else{var r=t+parseInt(Math.random()*100)+(new Date).getTime();i(this).data(f,r);i(this).data(t,i.extend({},e,o))}u.init(i(this),n)});n&&(u[n]?(h=i("body"),h.data(t,i.extend({},e,o)),u[n].apply(this,[h])):alert(n+" is not a valid method!"))}}}(),e=function(){var t="notificationsDropdown",f=t+"Id",e={},u={init:function(n,t){if(t){this[t]?this[t].apply(this,[n]):alert(t+" is not a valid method!");return}this.bind(n)},bind:function(n){n.find('[data-provide="notifications"]').notifications();n.find(".dropdown-toggle").click(function(t){t.preventDefault();u.markRead(n)})},update:function(n){n.find('[data-provide="notifications"]').notifications("update")},markRead:function(t){var i=t.find('[data-provide="notificationsBadge"]');i.hasClass("hidden")||r.http({url:n.$.Plato.defaults.pathBase+"/api/notifications/user/markread",method:"POSt"}).done(function(n){n.statusCode===200&&n.result&&i.notificationsBadge("hide")})}};return{init:function(){for(var r,h,o={},n=null,s=0;s<arguments.length;++s)if(r=arguments[s],r)switch(r.constructor){case Object:i.extend(o,r);break;case String:n=r}if(this.length>0)return this.each(function(){if(i(this).data(f))i(this).data(t,i.extend({},i(this).data(t),o));else{var r=t+parseInt(Math.random()*100)+(new Date).getTime();i(this).data(f,r);i(this).data(t,i.extend({},e,o))}u.init(i(this),n)});n&&(u[n]?(h=i("body"),h.data(t,i.extend({},e,o)),u[n].apply(this,[h])):alert(n+" is not a valid method!"))}}}();i.fn.extend({notifications:u.init,notificationsBadge:f.init,notificationsDropdown:e.init});r.ready(function(){var n=i('[data-provide="notificationsDropdown"]'),t=i('[data-provide="notificationsBadge"]');n.notificationsDropdown();t.notificationsBadge({onShow:function(){},onHide:function(n){n.data("notificationsBadge").prevCount=0},onPollComplete:function(t,i){t.data("notificationsBadge").prevCount!==i&&i>0&&(t.notificationsBadge({count:i},"show"),n.notificationsDropdown("update"));t.data("notificationsBadge").prevCount=i}})})}(window,document,jQuery));