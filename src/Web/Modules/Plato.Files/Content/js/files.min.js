if(typeof $().modal=="undefined")throw new Error("BootStrap 4.1.1 or above Required");if(typeof window.$.Plato=="undefined")throw new Error("$.Plato Required");$(function(n,t,i){"use strict";n.$.Plato.Files={allowedExtensions:["txt","html","zip","png","gif","bmp","jpg","jpeg"],maxFileSize:0};var r=n.$.Plato,u=function(){var t="editFile",u=t+"Id",f={fileId:0},e={init:function(n,t,i){if(i)return i(this);if(t)return this[t]!==null&&typeof this[t]!="undefined"?this[t].apply(this,[n]):alert(t+" is not a valid method!"),null;this.bind(n)},bind:function(t){var i=this._getFileId(t),u=this._getReturnUrl(t),f=i===0?'Add files by dropping here or <a id="#dzUpload" class="dz-clickable" href="#">click to browse<\/a>':'Update this file by dropping a new file here or <a id="#dzUpload" class="dz-clickable" href="#">click to browse<\/a>';t.find('[data-provide="file-dropzone"]').fileDropzone({allowedExtensions:r.Files.allowedExtensions,maxFileSize:r.Files.maxFileSize,dropZoneOptions:{url:"/api/files/post",fallbackClick:!1,autoProcessQueue:!0,autoDiscover:!1,disablePreview:!0,uploadMultiple:!1,dictDefaultMessage:'<p class="text-center"><i class="fal fa-arrow-from-top fa-flip-vertical fa-2x d-block text-muted mb-2"><\/i>'+f+"<\/p>"},onQueuecomplete:function(t){t.length===0&&(n.location=u)},onError:function(){}})},_getFileId:function(n){return n.data("fileId")||n.data(t).fileId},_getReturnUrl:function(n){return n.data("returnUrl")||n.data(t).returnUrl}};return{init:function(){for(var o,n,l,r={},s=null,c=null,h=0;h<arguments.length;++h){o=arguments[h];switch(o.constructor){case Object:i.extend(r,o);break;case String:s=o;break;case Function:c=o}}return this.length>0?this.each(function(){if(i(this).data(u))i(this).data(t,i.extend({},i(this).data(t),r));else{var n=t+parseInt(Math.random()*100)+(new Date).getTime();i(this).data(u,n);i(this).data(t,i.extend({},f,r))}e.init(i(this),s)}):(n=i('[data-provide="http-content"]'),n.length>0)?(n.data(u)?n.data(t,i.extend({},n.data(t),r)):(l=t+parseInt(Math.random()*100)+(new Date).getTime(),n.data(u,l),n.data(t,i.extend({},f,r))),e.init(n,s,c)):void 0}}}(),f=function(){var n="fileDropdown",t=n+"Id",u={},f={init:function(n,t,i){if(i)return i(this);if(t)return this[t]!==null&&typeof this[t]!="undefined"?this[t].apply(this,[n]):alert(t+" is not a valid method!"),null;this.bind(n)},bind:function(n){n.find('[data-provide="http-content"]').httpContent({onLoad:function(t){var u=t.find('[data-provide="delete-file"]');u.length>0&&u.click(function(t){var u,f,e;if(t.preventDefault(),t.stopPropagation(),u=i(this).find("i"),u.length>0&&u.removeClass("fa-times").addClass("fa-spinner").addClass("fa-spin"),f=i(this).attr("href"),f==="")throw new Error("A delete url is required!");if(e=parseInt(i(this).data("fileId")),isNaN(e))throw new Error("A data-file-id attribute is required!");r.http({method:"POST",url:f,data:JSON.stringify(e)}).done(function(){n.find('[data-provide="http-content"]').httpContent("reload")})})}});n.find('[data-provide="file-dropzone"]').fileDropzone({allowedExtensions:r.Files.allowedExtensions,maxFileSize:r.Files.maxFileSize,onDrop:function(){n.find(".dropdown").each(function(){i(this).find(".dropdown-menu").removeClass("show")})},onAddedFile:function(){},onComplete:function(){n.find('[data-provide="http-content"]').httpContent("reload")},onSuccess:function(){},onError:function(){}})}};return{init:function(){for(var o,r,l,e={},s=null,c=null,h=0;h<arguments.length;++h){o=arguments[h];switch(o.constructor){case Object:i.extend(e,o);break;case String:s=o;break;case Function:c=o}}return this.length>0?this.each(function(){if(i(this).data(t))i(this).data(n,i.extend({},i(this).data(n),e));else{var r=n+parseInt(Math.random()*100)+(new Date).getTime();i(this).data(t,r);i(this).data(n,i.extend({},u,e))}f.init(i(this),s)}):(r=i('[data-provide="file-dropdown"]'),r.length>0)?(r.data(t)?r.data(n,i.extend({},r.data(n),e)):(l=n+parseInt(Math.random()*100)+(new Date).getTime(),r.data(t,l),r.data(n,i.extend({},u,e))),f.init(r,s,c)):void 0}}}(),e=function(){var t="fileDropzone",u=t+"Id",e={progressPreview:"#progress",allowedExtensions:["txt","html","zip","png","gif","bmp","jpg","jpeg","pdf"],maxFiles:10,maxFileSize:2097152,dropZoneOptions:{url:"/api/files/post",fallbackClick:!1,autoProcessQueue:!0,autoDiscover:!1,disablePreview:!0,uploadMultiple:!1,dictDefaultMessage:'<p class="text-center"><i class="fal fa-arrow-from-top fa-flip-vertical fa-2x d-block text-muted mb-2"><\/i>Drag & drop files here or <a id="#dzUpload" class="dz-clickable" href="#">click to browse<\/a><\/p>'},onAddedFile:function(){},onDrop:function(){},onSuccess:function(){},onError:function(){},onComplete:function(){},onQueuecomplete:function(){}},f={init:function(n,t){if(t){this[t]?this[t].apply(this,[n]):alert(t+" is not a valid method!");return}this.bind(n)},bind:function(u){var e=u.data(t).dropZoneOptions,s=this._getUrl(u),c=this._getMaxFiles(u),o,h;if(s===null)throw new Error("An post url is required for the dropzone!");e.init||(e.maxFilesize=Math.ceil(u.data(t).maxFileSize/1048576),e.maxFiles=c,r.defaults&&(o=r.defaults.getCsrfCookieToken(),o===""&&alert("An error occurred. No valid CSRF token could be obtained for the request."),e.url=r.defaults.url+s,e.headers={Authorization:"Basic "+r.defaults.apiKey,"X-Csrf-Token":o}),e.init=function(){function s(n){return"progress-"+n.upload.uuid}function l(n){var t=i("<div>",{id:s(n),"class":"progress-row m-3"}),u=i("<div>",{"class":"progress-info text-center mb-2"}),r=i("<div>",{"class":"progress"});return r.append(i("<div>",{"class":"progress-bar",role:"progressbar",style:"width: 0;"})),t.append(u),t.append(r),t}function h(n){var t;if(o===null||o.length===0)return!1;var u=n.upload.filename,i=u.split("."),f=i[i.length-1],r=null;for(t=0;t<o.length;t++)if(r=o[t],f.toLowerCase()===r.toLowerCase())return!0;return!1}function c(){for(var u="",t=0;t<n.length;t++)u+=n[t],t<n.length-1&&(u+="\n\n");i().dialog({title:r.T("Some problems occurred"),body:{url:null,html:u.replace(/\n/g,"<br/>")},css:{body:"modal-body max-h-200 overflow-auto"},buttons:[{id:"ok",text:"OK",css:"btn btn-primary",click:function(){return i().dialog("hide"),!1}}]},"show")}var e=f._getProgressPreview(u),o=u.data(t).allowedExtensions,n=[];this.on("addedfiles",function(t){var u,i,r;for(n=[],u=!0,i=null,r=0;r<t.length;r++)i=t[r],i.upload&&(h(i)||(u=!1));return u});this.on("addedfile",function(i){if(!h(i))return n.push(r.T("Some files are not allowed. Allowed types are ")+o.join(", ")+"\n\n"+r.T("Files that are allowed have still been uploaded")),c(),this.removeFile(i),!1;if(e&&e.append(l(i)),u.data(t).onAddedFile)u.data(t).onAddedFile(i);return!0});this.on("drop",function(n){if(u.data(t).onDrop)u.data(t).onDrop(n)});this.on("uploadprogress",function(n,t,i){if(e){t=Math.floor(i/n.size*100);var u="#"+s(n),r=e.find(u);r.find(".progress-info").text(t+"%");r.find(".progress-bar").width(t+"%")}});this.on("success",function(i,r){var f,o,c,h;if(r.statusCode===200&&r&&r.result)for(f=0;f<r.result.length;f++)o=r.result[f],o.error&&o.error!==""&&n.push(o.error);if(e&&(c="#"+s(i),h=e.find(c),h.length>0&&h.remove()),u.data(t).onSuccess)u.data(t).onSuccess(r)});this.on("complete",function(i){if(u.data(t).onComplete)u.data(t).onComplete(i,n)});this.on("error",function(n,i,f){var h="<h6>"+r.T("A problem occurred!")+"<\/h6>",c,o;if(h+='<textarea class="form-control">'+i+"<\/textarea>",r.ui.notify({message:h},{mouse_over:"pause",type:"danger",allow_dismiss:!0}),e&&(c="#"+s(n),o=e.find(c),o.length>0&&o.remove()),u.data(t).onError)u.data(t).onError(n,i,f)});this.on("queuecomplete",function(){if(n.length>0&&c(),u.data(t).onQueuecomplete)u.data(t).onQueuecomplete(n)})});n.Dropzone?(h=new n.Dropzone(u[0],e),u.data("dropzone",h)):console.log("Dropzone was configured but Dropzone was not detected. Ensure the Plato.Dropzone feature is enabled.")},_getProgressPreview:function(n){var u=n.data("progressPreview")||n.data(t).progressPreview,r;return u&&(r=i(u),r.length>0)?r:null},_getUrl:function(n){return n.data("dropzoneUrl")||n.data(t).dropZoneOptions.url},_getMaxFiles:function(n){var i=n.data("dropzoneMaxFiles"),r;return i!==null&&typeof i!="undefined"&&(r=parseInt(i),!isNaN(r))?r:n.data(t).maxFiles}};return{init:function(){for(var o,n,l,r={},s=null,c=null,h=0;h<arguments.length;++h){o=arguments[h];switch(o.constructor){case Object:i.extend(r,o);break;case String:s=o;break;case Function:c=o}}return this.length>0?this.each(function(){if(i(this).data(u))i(this).data(t,i.extend({},i(this).data(t),r));else{var n=t+parseInt(Math.random()*100)+(new Date).getTime();i(this).data(u,n);i(this).data(t,i.extend({},e,r))}f.init(i(this),s)}):(n=i('[data-provide="attachment-dropzone"]'),n.length>0)?(n.data(u)?n.data(t,i.extend({},n.data(t),r)):(l=t+parseInt(Math.random()*100)+(new Date).getTime(),n.data(u,l),n.data(t,i.extend({},e,r))),f.init(n,s,c)):void 0}}}();i.fn.extend({editFile:u.init,fileDropdown:f.init,fileDropzone:e.init});r.ready(function(){i('[data-provide="edit-file"]').editFile();i('[data-provide="file-dropdown"]').fileDropdown()});i().infiniteScroll(function(){},"ready")}(window,document,jQuery));