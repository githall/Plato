if(typeof jQuery=="undefined")throw new Error("jQuery 3.3.1 or above Required");if(typeof window.$.Plato=="undefined")throw new Error("$.Plato Required");(function(n,t,i){"use strict";var r=t.$.Plato,u=function(){var e="markdown",o=e+"Id",s={autofocus:!1,hideable:!1,savable:!0,width:"inherit",height:"inherit",resize:null,iconlibrary:"fa",language:"en",initialstate:"editor",parser:null,allowedUploadExtensions:["txt","html","zip","png","gif","bmp","jpg","jpeg"],dropZoneOptions:{url:"/api/media/streaming/upload",fallbackClick:!1,maxFilesize:32,autoProcessQueue:!0,autoDiscover:!1,disablePreview:!0,dictDefaultMessage:'Embed images by dragging and dropping here, <a id="#dzUpload" class="dz-clickable" href="#">click to browse<\/a> or paste from the clipboard'},enableDropDataUri:!1,footer:"",fullscreen:{enable:!0,icons:{fullscreenOn:{name:"fullscreenOn",icon:{fa:"fal fa-expand",glyph:"glyphicon glyphicon-fullscreen","fa-3":"icon-resize-full",octicons:"octicon octicon-link-external"}},fullscreenOff:{name:"fullscreenOff",icon:{fa:"fal fa-compress",glyph:"glyphicon glyphicon-fullscreen","fa-3":"icon-resize-small",octicons:"octicon octicon-browser"}}}},localStorageKey:"plato-markdown",buttons:[[{name:"groupFont",css:"btn-group mr-1",data:[{name:"cmdBold",hotkey:"Ctrl+B",title:"Bold",icon:{glyph:"glyphicon glyphicon-bold",fa:"fal fa-bold","fa-3":"icon-bold",octicons:"octicon octicon-bold"},callback:function(n){var i,r,t=n.getSelection(),u=n.getContent();i=t.length===0?n.__localize("strong text"):t.text;u.substr(t.start-2,2)==="**"&&u.substr(t.end,2)==="**"?(n.setSelection(t.start-2,t.end+2),n.replaceSelection(i),r=t.start-2):(n.replaceSelection("**"+i+"**"),r=t.start+2);n.setSelection(r,r+i.length)}},{name:"cmdItalic",title:"Italic",hotkey:"Ctrl+I",icon:{glyph:"glyphicon glyphicon-italic",fa:"fal fa-italic","fa-3":"icon-italic",octicons:"octicon octicon-italic"},callback:function(n){var i,r,t=n.getSelection(),u=n.getContent();i=t.length===0?n.__localize("emphasized text"):t.text;u.substr(t.start-1,1)==="_"&&u.substr(t.end,1)==="_"?(n.setSelection(t.start-1,t.end+1),n.replaceSelection(i),r=t.start-1):(n.replaceSelection("_"+i+"_"),r=t.start+1);n.setSelection(r,r+i.length)}},{name:"cmdHeading",title:"Heading",hotkey:"Ctrl+H",dropdown:{title:"Heading",width:"200px",css:"dropdown-menu-right md-header-dropdown",items:[{name:"cmdHeading1",hotkey:"",text:"<h1>Header 1<\/h1>",value:"#",callback:function(t,i){n.fn.markdown.handlers.insertHeader(t,i)}},{name:"cmdHeading2",text:"<h2>Header 2<\/h2>",value:"##",callback:function(t,i){n.fn.markdown.handlers.insertHeader(t,i)}},{name:"cmdHeading3",text:"<h3>Header 3<\/h3>",value:"###",callback:function(t,i){n.fn.markdown.handlers.insertHeader(t,i)}},{name:"cmdHeading4",text:"<h4>Header 4<\/h4>",value:"####",callback:function(t,i){n.fn.markdown.handlers.insertHeader(t,i)}},{name:"cmdHeading5",text:"<h5>Header 5<\/h5>",value:"#####",callback:function(t,i){n.fn.markdown.handlers.insertHeader(t,i)}},{name:"cmdHeading6",text:"<h6>Header 6<\/h6>",value:"######",callback:function(t,i){n.fn.markdown.handlers.insertHeader(t,i)}}]},icon:{glyph:"glyphicon glyphicon-header",fa:"fal fa-heading","fa-3":"icon-font",octicons:"octicon octicon-text-size"},callback:function(){}}]},{name:"groupInsert",css:"btn-group btn-group-insert mr-1",data:[{name:"cmdLink",title:"Link To URL",hotkey:"Ctrl+L",dropdown:{title:"Link To URL",width:"450px",css:"dropdown-menu-right",items:null,html:'<div class="m-2"><fieldset><input type="link" class="form-control"/><button role="button" type="button" class="btn btn-block btn-primary mt-2"><\/button><\/fieldset><\/div>'},icon:{glyph:"glyphicon glyphicon-link",fa:"fal fa-link","fa-3":"icon-link",octicons:"octicon octicon-link"},callback:function(t,i){var o=t.__localize("https://"),s=t.__localize("Add Link"),r=t.$editor.find("#"+i.attr("data-dropdown-target"));if(r.length!==0){var u=r.find(".dropdown-menu"),f=u.find("input"),e=u.find("button");f.attr("placeholder",o);e.text(s);e.unbind("click").bind("click",function(){var o;t.focus();var r,u,e=t.getSelection(),s=t.getContent(),i=f.val().trim();r=e.length===0?t.__localize("enter link description here"):e.text;i!==null&&i!==""&&i!=="http://"&&i!=="https://"&&(o=n("<div>"+i+"<\/div>").text(),t.replaceSelection("["+r+"]("+o+")"),u=e.start+1,t.setSelection(u,u+r.length),t.$textarea.focus())})}}},{name:"cmdImage",title:"Link To Image",hotkey:"Ctrl+G",dropdown:{title:"Link To Image",width:"450px",css:"dropdown-menu-right",items:null,html:'<div class="m-2"><fieldset><input type="link" class="form-control"/><button role="button" type="button" class="btn btn-block btn-primary mt-2"><\/button><\/fieldset><\/div>'},icon:{glyph:"glyphicon glyphicon-picture",fa:"fal fa-image","fa-3":"icon-picture",octicons:"octicon octicon-file-media"},callback:function(t,i){var o=t.__localize("https://"),s=t.__localize("Add Image"),r=t.$editor.find("#"+i.attr("data-dropdown-target"));if(r.length!==0){var u=r.find(".dropdown-menu"),f=u.find("input"),e=u.find("button");f.attr("placeholder",o);e.text(s);e.unbind("click").bind("click",function(){var r,u,e=t.getSelection(),i,o,s;r=e.length===0?t.__localize("enter image description here"):e.text;i=f.val().trim();o=new RegExp("^((http|https)://|(//))[a-z0-9]","i");i!==null&&i!==""&&i!=="http://"&&o.test(i)&&(s=n("<div>"+i+"<\/div>").text(),t.replaceSelection("!["+r+"]("+s+' "'+t.__localize("enter image title here")+'")'),u=e.start+2,t.setNextTab(t.__localize("enter image title here")),t.setSelection(u,u+r.length),t.$textarea.focus())})}}},{name:"cmdEmoji",title:"Add Emoji",hotkey:"Ctrl+Y",dropdown:{title:"Add Emoji",width:"450px",css:"dropdown-menu-right",items:null,html:'<div class="md-emoji-dropdown"><p class="my-4 text-center"><i class="fal my-4 fa-spinner fa-spin"><\/i><\/p><\/div>'},icon:{glyph:"glyphicon glyphicon-search",fa:"fal fa-smile","fa-3":"icon-search",octicons:"octicon octicon-search"},callback:function(t,i){var u=t.$editor.find("#"+i.attr("data-dropdown-target"));u.length!==0&&(u.data("emojiLoaded")||r.http({url:"api/markdown/emoji/get",method:"GET"}).done(function(i){var f,o,s;if(i.statusCode===200&&i.result){var r=0,h=null,e=null,c=u.find(".md-emoji-dropdown");for(c.empty(),f=n("<ul>",{"class":"nav nav-tabs",role:"tablist"}),r=0;r<i.result.length;r++){var l=i.result[r],a=n("<li>",{title:t.__localize(l.name),"data-toggle":"tooltip","class":r===0?"nav-item ml-2":"nav-item"}),v=n("<a>",{"class":r===0?"nav-link active":"nav-link","data-toggle":"tab","aria-controls":"emoji"+r,href:"#emoji"+r}).text(l.emoji);a.append(v);f.append(a)}for(c.append(f),f.find('[data-toggle="tooltip"]').tooltip({trigger:"hover"}),f.find("a").click(function(t){t.preventDefault();t.stopPropagation();n(this).tab("show")}),o=n("<div>",{"class":"tab-content overflow-auto"}),r=0;r<i.result.length;r++){h=n("<div>",{id:"emoji"+r,"aria-labelledby":"emoji"+r,role:"tabpanel","class":r===0?"tab-pane show active":"tab-pane"});e=i.result[r].emojis;for(s in e)e.hasOwnProperty(s)&&h.append(n("<button>",{type:"button",role:"button",title:s,"class":"dropdown-item d-inline float-left px-1 text-center"}).html(e[s]));o.append(h)}c.append(o);o.find("button").on("click",function(i){var r,u,f;i.preventDefault();u=t.getSelection();r=u.length===0?n(this).attr("title"):n(this).attr("title")+" "+u.text;t.replaceSelection(r);f=u.start+1;t.setSelection(f+r.length,f+r.length);t.$textarea.focus()});u.data("emojiLoaded",!0)}}))}},{name:"cmdVideo",title:"Add Video",hotkey:"Ctrl+Y",dropdown:{title:"Embed Video",width:"450px",css:"dropdown-menu-right",items:null,html:'<div class="m-2"><fieldset><input type="link" class="form-control"/><button role="button" type="button" class="btn btn-block btn-primary mt-2"><\/button><\/fieldset><\/div>'},icon:{glyph:"glyphicon glyphicon-search",fa:"fal fa-film","fa-3":"icon-search",octicons:"octicon octicon-search"},callback:function(t,i){function o(n){if(n.toLowerCase().indexOf("youtu.be")>=0){var t=n.toLowerCase().replace("https://","").replace("http://","").split("/"),i="";t.length>0&&(i=t[t.length-1].replace("?","&"));i!==""&&(n="https://www.youtube.com/watch?v="+i.trim())}return n.trim()}var s=t.__localize("https://www.youtube.com/watch?v=mswPy5bt3TQ"),h=t.__localize("Add Video"),c=t.__localize("You can only embed YouTube or Vimeo videos."),u=t.$editor.find("#"+i.attr("data-dropdown-target"));if(u.length!==0){var f=u.find(".dropdown-menu"),r=f.find("input"),e=f.find("button");r.attr("placeholder",s).focus();e.text(h);e.unbind("click").bind("click",function(i){var f=null,e,h=t.getSelection(),u=o(r.val()||""),s;if((u.toLowerCase().indexOf("youtube.com")>0||u.toLowerCase().indexOf("vimeo.com")>0)&&(f="Description"),u!==""&&f===null){i.stopPropagation();alert(c);r.focus();return}u!==""&&u!=="http://"&&u!=="https://"&&(s=n("<div>"+u+"<\/div>").text(),t.replaceSelection("!["+f+"]("+s+")"),e=h.start+2,t.setSelection(e,e+f.length),t.$textarea.focus())})}}}]},{name:"groupLists",css:"btn-group btn-group-lists mr-1",data:[{name:"cmdList",hotkey:"Ctrl+U",title:"Unordered List",icon:{glyph:"glyphicon glyphicon-list",fa:"fal fa-list","fa-3":"icon-list-ul",octicons:"octicon octicon-list-unordered"},callback:function(t){var r,f,i=t.getSelection(),e=t.getContent(),u;i.length===0?(r=t.__localize("list text here"),t.replaceSelection("- "+r),f=i.start+2):i.text.indexOf("\n")<0?(r=i.text,t.replaceSelection("- "+r),f=i.start+2):(u=[],u=i.text.split("\n"),r=u[0],n.each(u,function(n,t){u[n]="- "+t}),t.replaceSelection("\n\n"+u.join("\n")),f=i.start+4);t.setSelection(f,f+r.length)}},{name:"cmdListO",hotkey:"Ctrl+O",title:"Ordered List",icon:{glyph:"glyphicon glyphicon-th-list",fa:"fal fa-list-ol","fa-3":"icon-list-ol",octicons:"octicon octicon-list-ordered"},callback:function(t){var r,f,i=t.getSelection(),o=t.getContent(),e,u;i.length===0?(r=t.__localize("list text here"),t.replaceSelection("1. "+r),f=i.start+3):i.text.indexOf("\n")<0?(r=i.text,t.replaceSelection("1. "+r),f=i.start+3):(e=1,u=[],u=i.text.split("\n"),r=u[0],n.each(u,function(n,t){u[n]=e+". "+t;e++}),t.replaceSelection("\n\n"+u.join("\n")),f=i.start+5);t.setSelection(f,f+r.length)}}]},{name:"groupBlocks",css:"btn-group btn-group-quotes mr-1",data:[{name:"cmdBlockquote",title:"Blockquote",hotkey:"Ctrl+Q",dropdown:{title:"Blockquote",width:"200px",css:"dropdown-menu-right md-quote-dropdown markdown-body",items:[{name:"cmdBlockquotePrimary",hotkey:"",text:'<blockquote class="dropdown-item primary"><p>Primary<\/p><\/blockquote>',value:"> !primary ",callback:function(t,i){n.fn.markdown.handlers.insertQuote(t,i)}},{name:"cmdBlockquoteDefault",text:'<blockquote class="dropdown-item secondary"><p>Secondary<\/p><\/blockquote>',value:"> !secondary ",callback:function(t,i){n.fn.markdown.handlers.insertQuote(t,i)}},{name:"cmdBlockquoteInfo",text:'<blockquote class="dropdown-item info"><p>Info<\/p><\/blockquote>',value:"> !info ",callback:function(t,i){n.fn.markdown.handlers.insertQuote(t,i)}},{name:"cmdBlockquoteSuccess",text:'<blockquote class="dropdown-item success"><p>Success<\/p><\/blockquote>',value:"> !success ",callback:function(t,i){n.fn.markdown.handlers.insertQuote(t,i)}},{name:"cmdBlockquoteWarning",text:'<blockquote class="dropdown-item warning"><p>Warning<\/p><\/blockquote>',value:"> !warning ",callback:function(t,i){n.fn.markdown.handlers.insertQuote(t,i)}},{name:"cmdBlockquoteDanger",text:'<blockquote class="dropdown-item danger"><p>Danger<\/p><\/blockquote>',value:"> !danger ",callback:function(t,i){n.fn.markdown.handlers.insertQuote(t,i)}}]},icon:{glyph:"glyphicon glyphicon-comment",fa:"fal fa-quote-left","fa-3":"icon-quote-left",octicons:"octicon octicon-quote"},callback:function(){}}]},{name:"groupCode",css:"btn-group btn-group-code mr-1",data:[{name:"cmdCode",hotkey:"Ctrl+K",title:"Code",icon:{glyph:"glyphicon glyphicon-console",fa:"fal fa-code","fa-3":"icon-code",octicons:"octicon octicon-code"},callback:function(n){var i,r,t=n.getSelection(),u=n.getContent();i=t.length===0?n.__localize("code text here"):t.text;u.substr(t.start-4,4)==="```\n"&&u.substr(t.end,4)==="\n```"?(n.setSelection(t.start-4,t.end+4),n.replaceSelection(i),r=t.start-4):u.substr(t.start-1,1)==="`"&&u.substr(t.end,1)==="`"?(n.setSelection(t.start-1,t.end+1),n.replaceSelection(i),r=t.start-1):u.indexOf("\n")>-1?(n.replaceSelection("```\n"+i+"\n```"),r=t.start+4):(n.replaceSelection("`"+i+"`"),r=t.start+1);n.setSelection(r,r+i.length)}}]}]],customIcons:{},additionalButtons:[],reorderButtonGroups:[],hiddenButtons:[],disabledButtons:[],buttonContainer:"#markdownButtons",onShow:function(){},onPreview:function(){},onPreviewEnd:function(){},onSave:function(){},onBlur:function(){},onFocus:function(){},onChange:function(){},onFullscreen:function(){},onFullscreenExit:function(){},onSelect:function(){}},f={init:function(t,i,r){if(n.each(["autofocus","savable","hideable","width","height","resize","iconlibrary","language","footer","fullscreen","hiddenButtons","disabledButtons"],function(n,i){typeof t.data(i)!="undefined"&&(options=typeof options=="object"?options:{},options[i]=t.data(i))}),this.$ns="markdown",this.$element=t,this.$options=t.data(e),this.$editable={el:null,type:null,attrKeys:[],attrValues:[],content:null},this.$oldContent=null,this.$isPreview=!1,this.$isFullscreen=!1,this.$editor=null,this.$textarea=null,this.$handler=[],this.$callback=[],this.$nextTab=[],i)return this[i]!==null&&typeof this[i]!="undefined"?this[i].apply(this,[t,r]):(alert(i+" is not a valid method!"),null);this.showEditor()},_events:{ready:[],write:[],preview:[]},__alterButtons:function(t,i){var r=this.$handler,u=t==="all",f=this;n.each(r,function(n,r){var e=!0;e=u?!1:r.indexOf(t)<0;e===!1&&i(f.$editor.find('button[data-handler="'+r+'"]'))})},__buildButtons:function(t,i,r){for(var v=this.$ns,nt=this.$handler,tt=this.$callback,c,y,l,d,p,g,b,o,s,k,a=0;a<t.length;a++)for(y=t[a],c=0;c<y.length;c++){for(d=y[c].data,p=n("<div />",{"class":y[c].css,role:"group"}),l=0;l<d.length;l++){var u=d[l],it=v+"-"+u.name,rt=this.__getIcon(u),st=u.btnText?u.btnText:"",ut=u.btnClass?u.btnClass:"btn",ht=u.tabIndex?u.tabIndex:"-1",w=typeof u.hotkey!="undefined"?u.hotkey:"",ct=typeof jQuery.hotkeys!="undefined"&&w!==""?" ("+w+")":"",f=typeof u.dropdown!="undefined"?u.dropdown:null,ft=r+"-"+c+"-"+l,e=n('<button type="button" data-toggle="tooltip">');if(e.html(this.__localize(st)).addClass("btn").addClass(ut),ut.match(/btn\-(primary|success|info|warning|danger|link)/)&&e.removeClass("btn-secondary"),e.attr({title:this.__localize(u.title)+ct,tabindex:ht,"data-hotkey":w,"data-provider":v,"data-handler":it}),f&&(e.addClass("dropdown-toggle"),e.attr("data-toggle","dropdown"),e.attr("data-display","static"),e.attr("data-dropdown-target",ft)),u.toggle===!0&&e.attr("data-toggle","button"),rt&&(g=n("<i>"),g.addClass(rt),g.prependTo(e)),f){if(b=n("<div>",{id:ft,"class":"dropdown"}),o=n("<ul>",{"class":"dropdown-menu anim anim-2x anim-scale-in"}),f.css&&o.addClass(f.css),o.css({width:f.width||"250ox"}),f.height&&o.css({"max-height":f.height,"overflow-y":"auto"}),s=null,f.items!==null)for(k=0;k<f.items.length;k++){var h=f.items[k],et=v+"-"+h.name,lt=h.hotkey||"",at=h.value||"",ot=n('<button role="button" type="button" class="dropdown-item">');ot.html(h.text).attr({title:h.tooltip?this.__localize(h.tooltip)+lt:"","data-provider":v,"data-handler":et,"data-hotkey":w,"data-value":at});s=n("<li>");s.append(ot);o.append(s);nt.push(et);tt.push(h.callback)}else s=n("<li>"),s.append(f.html),o.append(s);b.append(e);b.append(o);p.append(b)}else p.append(e);nt.push(it);tt.push(u.callback)}i.append(p)}return i},__setListener:function(){this.$options.resize&&this.$textarea.css("resize",this.$options.resize);this.$textarea.data("markdown",this)},__setEventListeners:function(){this.$textarea.on({focus:n.proxy(this.focus,this),keyup:n.proxy(this.keyup,this),change:n.proxy(this.change,this),select:n.proxy(this.select,this)});if(this.eventSupported("keydown"))this.$textarea.on("keydown",n.proxy(this.keydown,this));if(this.eventSupported("keypress"))this.$textarea.on("keypress",n.proxy(this.keypress,this))},__handle:function(t){var i=n(t.currentTarget),u=this.$handler,f=this.$callback,r=i.attr("data-handler"),e=u.indexOf(r),o=f[e];o(this,i);this.change(this);r.indexOf("cmdSave")<0&&this.$textarea.focus();t.preventDefault()},__localize:function(t){var i=n.fn.markdown.messages,r=this.$options.language;return typeof i!="undefined"&&typeof i[r]!="undefined"&&typeof i[r][t]!="undefined"?i[r][t]:t},__getIcon:function(n){if(typeof n=="object"){var t=this.$options.customIcons[n.name];return typeof t=="undefined"?n.icon?n.icon[this.$options.iconlibrary]:null:t}return n},__parseButtonNameParam:function(n){return typeof n=="string"?n.split(" "):n},setFullscreen:function(t){var r=this.$editor,i=this.$textarea,u=r.closest(".resizable"),e=i.height(),o=u.height(),f;if(t===!0){r.addClass("md-fullscreen-mode");n("body").addClass("md-nooverflow");this.$options.onFullscreen(this);u.css({height:"100%"});i.css({height:"100%"});i.data("height",e);u.data("height",o);i.focus();this.$isPreview===!0&&(f=r.find(".md-preview"),f.find("pre").css({"max-width":r.width()}),f.find("table").css({"max-width":r.width()}))}else{r.removeClass("md-fullscreen-mode");n("body").removeClass("md-nooverflow");this.$options.onFullscreenExit(this);i.focus();i.data("height")&&i.css({height:i.data("height")+"px"});u.data("height")&&u.css({height:u.data("height")+"px"});this.$isPreview===!0&&this.hidePreview().showPreview()}this.$isFullscreen=t},showEditor:function(){var h=this,u,gt=this.$ns,e=this.$element,c=this.$editable,wt=this.$handler,bt=this.$callback,i=this.$options,f=n("<div/>",{"class":"md-editor",click:function(){h.focus()}}),nt,tt,it,ct,lt,at,p,w,vt,l,y,ut,yt,pt,b;if(this.$editor===null){var o=(new Date).getTime(),k=n("<div/>",{"class":"md-header"}),d=n("<div/>",{"class":"md-header-row"}),ft=n("<div/>",{"class":"md-header-left"}),et=n("<div/>",{"class":"md-header-right"}),g=n("<ul/>",{"class":"nav nav-tabs",roles:"tablist"}),a=n("<div/>",{"class":"btn-toolbar"}),ot=n("<a/>",{"class":"nav-link active",href:"#writeTab"+o,text:"Write",role:"tab",id:"writeLink"+o,"data-editor-id":o});ot.on("click",function(n){n.preventDefault();h.hidePreview()});nt=n("<li/>",{"class":"nav-item"});nt.append(ot);tt=n("<a/>",{"class":"nav-link",href:"#previewTab"+o,text:"Preview",role:"tab",id:"previewLink"+o,"data-editor-id":o});tt.on("click",function(n){n.preventDefault();h.showPreview()});it=n("<li/>",{"class":"nav-item"});it.append(tt);g.append(nt);g.append(it);var rt=n("<div/>",{"class":"tab-content d-block"}),st=n("<div/>",{"class":"tab-pane position-relative show active md-write",role:"tabpanel",id:"writeTab"+o}),ht=n("<div/>",{"class":"tab-pane md-preview markdown-body",role:"tabpanel",id:"previewTab"+o}),kt=n("<div/>",{"class":"md-dropzone-progress"}),dt=n("<div/>",{"class":"md-dropzone dropzone"}),v=n("<div/>",{"class":"md-footer"}),s=[];if(i.buttons.length>0&&(s=s.concat(i.buttons[0])),i.additionalButtons.length>0&&n.each(i.additionalButtons[0],function(t,r){var u=n.grep(s,function(n){return n.name===r.name});u.length>0?u[0].data=u[0].data.concat(r.data):s.push(i.additionalButtons[0][t])}),i.reorderButtonGroups.length>0&&(s=s.filter(function(n){return i.reorderButtonGroups.indexOf(n.name)>-1}).sort(function(n,t){return i.reorderButtonGroups.indexOf(n.name)<i.reorderButtonGroups.indexOf(t.name)?-1:i.reorderButtonGroups.indexOf(n.name)>i.reorderButtonGroups.indexOf(t.name)?1:0})),s.length>0&&(a=this.__buildButtons([s],a,o)),i.fullscreen.enable){ct=this.__localize("Full Screen");a.append('<div class="btn-group"><button class="btn md-control-fullscreen" data-tooltip-position="bottom" title="'+ct+'"><i class="'+this.__getIcon(i.fullscreen.icons.fullscreenOn)+'"><\/i><\/button><\/div>').on("click",".md-control-fullscreen",function(n){n.preventDefault();h.setFullscreen(!0)})}if(i.fullscreen.enable&&i.fullscreen!==!1)a.append('<div class="btn-group md-fullscreen-controls"><button class="btn md-exit-fullscreen" title="Exit fullscreen"><i class="'+this.__getIcon(i.fullscreen.icons.fullscreenOff)+'"><\/i><\/button><\/div>').on("click",".md-exit-fullscreen",function(n){n.preventDefault();h.setFullscreen(!1)});ft.append(g);et.append(a);d.append(ft);d.append(et);f.append(d);e.is("textarea")?(e.before(f),u=e,st.append(u),ht.append(n("<div/>")),rt.append(st),rt.append(ht),f.append(rt)):(lt=typeof toMarkdown=="function"?toMarkdown(e.html()):e.html(),at=n.trim(lt),u=n("<textarea/>",{"class":"form-control md-textarea",val:at}),f.append(u),c.el=e,c.type=e.prop("tagName").toLowerCase(),c.content=e.html(),n(e[0].attributes).each(function(){c.attrKeys.push(this.nodeName);c.attrValues.push(this.nodeValue)}),e.replaceWith(f));p=!1;w="";i.savable&&(p=!0,vt="cmdSave",wt.push(vt),bt.push(i.onSave),v.append('<button type="submit" class="btn btn-primary">'+this.__localize("Save")+"<\/button>"));w=typeof i.footer=="function"?i.footer(this):i.footer;n.trim(w)!==""&&(p=!0,v.append(w));f.append(kt);f.append(dt);p&&f.append(v);i.width&&i.width!=="inherit"&&(n.isNumeric(i.width)?(f.css("display","table"),u.css("width",i.width+"px")):f.addClass(i.width));i.height&&i.height!=="inherit"&&(n.isNumeric(i.height)?(l=i.height,k&&(l=Math.max(0,l-k.outerHeight())),v&&(l=Math.max(0,l-v.outerHeight())),u.css("height",l+"px")):f.addClass(i.height));this.$editor=f;this.$textarea=u;this.$editable=c;this.$oldContent=this.getContent();this.__setListener();this.__setEventListeners();this.$editor.attr("id",o);this.$editor.on("click",'[data-provider="markdown"]',n.proxy(this.__handle,this));this.$editor.find("button").tooltip({trigger:"hover"});(this.$element.is(":disabled")||this.$element.is("[readonly]"))&&(this.$editor.addClass("md-editor-disabled"),this.disableButtons("all"));this.eventSupported("keydown")&&typeof jQuery.hotkeys=="object"&&k.find('[data-provider="markdown"]').each(function(){var t=n(this),i=t.attr("data-hotkey");i.toLowerCase()!==""&&u.bind("keydown",i,function(){return t.trigger("click"),!1})});i.initialstate==="preview"?this.showPreview():i.initialstate==="fullscreen"&&i.fullscreen.enable&&this.setFullscreen(!0);this.$textarea.on("keyup keypress paste",function(){r.storage.set(t.location.href,n(this).val())});y=r.storage.get(t.location.href);y&&y.trim()!==""&&(this.$textarea.val().trim()===""?this.$textarea.val(y):n().dialog({title:"Restore changes?",body:{url:null,html:"We've detected you have some unsaved changes. Would you like to discard or restore these changes?"},buttons:[{id:"discard",text:"Dicard",css:"btn btn-secondary",click:function(){r.storage.remove(t.location.href);n().dialog("hide")}},{id:"restore",text:"Restore",css:"btn btn-primary",click:function(){n().dialog("hide");u.val(y)}}]},"show"))}else this.$editor.show();i.autofocus&&(this.$textarea.focus(),this.$editor.addClass("active"));this.hideButtons(i.hiddenButtons);this.disableButtons(i.disabledButtons);i.dropZoneOptions&&(this.$editor.dropzone?(i.dropZoneOptions.init||(r.defaults&&(ut=r.defaults.getCsrfCookieToken(),ut===""&&alert("An error occurred. No valid CSRF token could be obtained for the request."),i.dropZoneOptions.url=r.defaults.url+i.dropZoneOptions.url,i.dropZoneOptions.headers={Authorization:"Basic "+r.defaults.apiKey,"X-Csrf-Token":ut}),i.dropZoneOptions.init=function(){function s(n){return"progress-"+n.upload.uuid}function c(t){var i=n("<div>",{id:s(t),"class":"progress-row mx-3 my-2"}),u=n("<div>",{"class":"progress-info text-center mb-2"}),r=n("<div>",{"class":"progress"});return r.append(n("<div>",{"class":"progress-bar",role:"progressbar",style:"width: 0;"})),i.append(u),i.append(r),i}var e=0,t=f.find(".md-dropzone-progress"),o=i.allowedUploadExtensions;this.on("addedfile",function(n){var r,f,s,h,i,l;if(e=u.prop("selectionStart"),r=n.upload.filename,f=!1,r&&o)for(s=r.split("."),h=s[s.length-1],i=0;i<o.length;i++)l=o[i],h.toLowerCase()===l.toLowerCase()&&(f=!0);return f===!1?(alert("File type is not allowed.\n\nAllowed types are "+o.join(", ")),this.removeFile(n),!1):(t&&t.append(c(n)),!0)});this.on("drop",function(){e=u.prop("selectionStart")});this.on("uploadprogress",function(n,i,r){if(t){i=Math.floor(r/n.size*100);var f="#"+s(n),u=t.find(f);u.find(".progress-info").text(i+"%");u.find(".progress-bar").width(i+"%")}});this.on("success",function(n,i){var f,a,c;if(i.statusCode===200&&i&&i.result)for(f=0;f<i.result.length;f++){var r=i.result[f],l=u.val(),o="";r.id>0&&(o=r.isImage?"!["+r.name+"](/media/"+r.id+")":"["+r.name+"](/media/"+r.id+") - "+r.friendlySize,u.val(l.substring(0,e)+o+"\n\n"+l.substring(e)),h.setSelection(e+o.length,e+o.length))}t&&(a="#"+s(n),c=t.find(a),c.length>0&&c.remove())});this.on("error",function(n,i){var u="<h6>"+r.T("An error occurred!")+"<\/h6>",e,f;u+=r.T("Information is provided below...")+"<br/><br/>";u+='<textarea style="min-height: 130px;" class="form-control">'+i+"<\/textarea>";r.ui.notify({message:u},{mouse_over:"pause",type:"danger",allow_dismiss:!0});t&&(e="#"+s(n),f=t.find(e),f.length>0&&f.remove())})}),yt=this.$editor.find(".md-dropzone"),pt=new Dropzone(yt[0],i.dropZoneOptions),this.$editor.data("dropzone",pt)):console.log("Dropzone options were configured but Dropzone was not detected. Ensure the Plato.Dropzone feature is enabled."));this.$editor.on("paste",function(t){var r=(t.clipboardData||t.originalEvent.clipboardData).items,f,i;for(f in r)i=r[f],i.kind==="file"&&(u.focus(),n(this).data("dropzone").addFile(i.getAsFile()))});if(i.enableDropDataUri===!0)this.$editor.on("drop",function(t){var i=u.prop("selectionStart");t.stopPropagation();t.preventDefault();n.each(t.originalEvent.dataTransfer.files,function(n,t){var r=new FileReader;r.onload=function(n){var t=n.type.split("/")[0];return function(r){var f=u.val();t==="image"?u.val(f.substring(0,i)+'\n<img src="'+r.target.result+'" />\n'+f.substring(i)):u.val(f.substring(0,i)+'\n<a href="'+r.target.result+'">Download '+n.name+"<\/a>\n"+f.substring(i))}}(t);r.readAsDataURL(t)})});i.onShow(this);if(this._events)for(b=0;b<this._events.ready.length;b++)this._events.ready[b](this);return this},parseContent:function(n){return n=n||this.$textarea.val(),this.$options.parser?this.$options.parser(n):typeof u=="object"?u.toHTML(n):typeof u=="function"?u(n):n},showPreview:function(){var o,s,h;if(this.$isPreview===!0)return this;var v=this,y=this.$element,p=this.$options,t=this.$editor,e=t.find(".md-dropzone"),i=this.$textarea,c=n("#writeTab"+t.attr("id")),l=n("#writeLink"+t.attr("id")),u=n("#previewTab"+t.attr("id")),a=n("#previewLink"+t.attr("id"));return i.val().trim()===""?(i.focus(),!1):(this.$isPreview=!0,o=0,s=0,i.length>0&&(o=i.outerHeight()),e.length>0&&(s=e.outerHeight()),h=o+s,h>0&&!this.$isFullscreen&&u.css({height:h}),r.http({url:"api/markdown/parse/post",method:"POST",async:!1,data:JSON.stringify({markdown:i.val().trim()})}).done(function(n){if(l.removeClass("active"),c.hide(),a.addClass("active"),u.show(),n.statusCode===200){u.empty().html(n.result);f.$options.onPreview(this,u);if(f._events)for(var t=0;t<f._events.preview.length;t++)f._events.preview[t](u)}}),this.disableButtons("all"),e.hide(),(this.$element.is(":disabled")||this.$element.is("[readonly]"))&&(this.$editor.addClass("md-editor-disabled"),this.disableButtons("all")),this)},hidePreview:function(){var o,i;this.$isPreview=!1;var t=this.$editor,c=this.$textarea,r=t.find(".md-dropzone"),u=n("#writeTab"+t.attr("id")),l=n("#writeLink"+t.attr("id")),e=n("#previewTab"+t.attr("id")),a=n("#previewLink"+t.attr("id")),s=0,h=0;e.length>0&&(s=e.outerHeight());r.length>0&&(h=r.outerHeight());o=s-h;o>0&&!this.$isFullscreen&&c.css({height:o});l.addClass("active");u.show();a.removeClass("active");e.hide();this.enableButtons("all");this.disableButtons(this.$options.disabledButtons);r.show();this.$options.onPreviewEnd(this,u);if(f._events)for(i=0;i<f._events.write.length;i++)f._events.write[i](u);return this},isDirty:function(){return this.$oldContent!==this.getContent()},getContent:function(){return this.$textarea.val()},setContent:function(n){return this.$textarea.val(n),this},findSelection:function(n){var u=this.getContent(),t,i,r;return(t=u.indexOf(n),t>=0&&n.length>0)?(i=this.getSelection(),this.setSelection(t,t+n.length),r=this.getSelection(),this.setSelection(i.start,i.end),r):null},getSelection:function(){var n=this.$textarea[0];return("selectionStart"in n&&function(){var t=n.selectionEnd-n.selectionStart;return{start:n.selectionStart,end:n.selectionEnd,length:t,text:n.value.substr(n.selectionStart,t)}}||function(){return null})()},setSelection:function(n,t){var i=this.$textarea[0];return("selectionStart"in i&&function(){i.selectionStart=n;i.selectionEnd=t;return}||function(){return null})()},replaceSelection:function(n){var t=this.$textarea[0];return("selectionStart"in t&&function(){return t.value=t.value.substr(0,t.selectionStart)+n+t.value.substr(t.selectionEnd,t.value.length),t.selectionStart=t.value.length,this}||function(){return t.value+=n,jQuery(t)})()},getNextTab:function(){if(this.$nextTab.length===0)return null;var t,n=this.$nextTab.shift();return typeof n=="function"?t=n():typeof n=="object"&&n.length>0&&(t=n),t},setNextTab:function(n,t){var r,i;typeof n=="string"?(r=this,this.$nextTab.push(function(){return r.findSelection(n)})):typeof n=="number"&&typeof t=="number"&&(i=this.getSelection(),this.setSelection(n,t),this.$nextTab.push(this.getSelection()),this.setSelection(i.start,i.end));return},enableButtons:function(t){var i=this.__parseButtonNameParam(t),r=this;return n.each(i,function(n){r.__alterButtons(i[n],function(n){n.removeClass("disabled")})}),this},disableButtons:function(t){var i=this.__parseButtonNameParam(t),r=this;return n.each(i,function(n){r.__alterButtons(i[n],function(n){n.addClass("disabled")})}),this},hideButtons:function(t){var i=this.__parseButtonNameParam(t),r=this;return n.each(i,function(n){r.__alterButtons(i[n],function(n){n.addClass("hidden")})}),this},showButtons:function(t){var i=this.__parseButtonNameParam(t),r=this;return n.each(i,function(n){r.__alterButtons(i[n],function(n){n.removeClass("hidden")})}),this},eventSupported:function(n){var t=n in this.$element;return t||(this.$element.setAttribute(n,"return;"),t=typeof this.$element[n]=="function"),t},keyup:function(t){var i=!1,u,c,f,r,s,h;switch(t.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:(u=this.getNextTab(),u!==null)?(c=this,setTimeout(function(){c.setSelection(u.start,u.end)},500),i=!0):(f=this.getSelection(),f.start===f.end&&f.end===this.getContent().length?i=!1:(this.setSelection(this.getContent().length,this.getContent().length),i=!0));break;case 13:i=!1;var l=this.getContent().split(""),e=this.getSelection().start,o=-1;for(r=e-2;r>=0;r--)if(l[r]==="\n"){o=r;break}s=l[o+1];s==="-"?this.addBullet(e):n.isNumeric(s)&&(h=this.getBulletNumber(o+1),h&&this.addNumberedBullet(e,h));break;case 27:this.$isFullscreen&&this.setFullscreen(!1);i=!1;break;default:i=!1}i&&(t.stopPropagation(),t.preventDefault());this.$options.onChange(this)},insertContent:function(n,t){var i=this.getContent().slice(0,n),r=this.getContent().slice(n+1);this.setContent(i.concat(t).concat(r))},addBullet:function(n){this.insertContent(n,"- \n");this.setSelection(n+2,n+2)},addNumberedBullet:function(n,t){var r=t+1+". \n",i;this.insertContent(n,r);i=t.toString().length+2;this.setSelection(n+i,n+i)},getBulletNumber:function(t){var i=this.getContent().slice(t).split(".")[0];return n.isNumeric(i)?parseInt(i):null},change:function(){this.$options.onChange(this);return this},select:function(){this.$options.onSelect(this);return this},focus:function(){var t=this.$options,u=t.hideable,r=this.$editor;r.addClass("active");n(i).find(".md-editor").each(function(){if(n(this).attr("id")!==r.attr("id")){var t;(t=n(this).find("textarea").data("markdown"),t===null)&&(t=n(this).find('div[data-provider="markdown-preview"]').data("markdown"));t&&t.blur()}});t.onFocus(this);return this},blur:function(){var u=this.$options,f=u.hideable,i=this.$editor,t=this.$editable;if(i.hasClass("active")||this.$element.parent().length===0){if(i.removeClass("active"),f)if(t.el!==null){var r=n("<"+t.type+"/>"),e=this.getContent(),o=this.parseContent(e);n(t.attrKeys).each(function(n){r.attr(t.attrKeys[n],t.attrValues[n])});r.html(o);i.replaceWith(r)}else i.hide();u.onBlur(this)}return this},ready:function(n,t){return t&&f._events.events.ready.push(t),this},preview:function(n,t){return t&&f._events.preview.push(t),this}};return{init:function(){for(var i,c,t={},r=null,u=null,h=0;h<arguments.length;++h){i=arguments[h];switch(i.constructor){case Object:n.extend(t,i);break;case String:r=i;break;case Function:u=i}}if(this.length>0)return this.each(function(){if(n(this).data(o))n(this).data(e,n.extend({},n(this).data(e),t));else{var i=e+parseInt(Math.random()*100)+(new Date).getTime();n(this).data(o,i);n(this).data(e,n.extend({},s,t))}return f.init(n(this),r,u)});c=n('textarea[data-provide="markdown"]');c.each(function(){var i=n(this),h;if(i.length>0)return i.data(o)?i.data(e,n.extend({},i.data(e),t)):(h=e+parseInt(Math.random()*100)+(new Date).getTime(),i.data(o,h),i.data(e,n.extend({},s,t))),f.init(i,r,u)})}}}(),f;n.fn.extend({markdown:u.init});n.fn.markdown.messages={};n.fn.markdown.handlers={insertQuote:function(t,i){var u,o,r=t.getSelection(),s=t.getContent(),f=i.attr("data-value")||"> ",e;r.length===0?(u=t.__localize("quote here"),t.replaceSelection(f+u),o=r.start+f.length):r.text.indexOf("\n")<0?(u=r.text,t.replaceSelection(f+u),o=r.start+f.length):(e=[],e=r.text.split("\n"),u=e[0],n.each(e,function(n,t){e[n]=f+t}),t.replaceSelection(e.join("\n")),o=r.start+f.length);t.setSelection(o,o+u.length)},insertHeader:function(n,t){var f,e,i=n.getSelection(),o=n.getContent(),r,s,u=t.attr("data-value")||"#";f=i.length===0?n.__localize("heading text"):i.text;(r=u.length+1,o.substr(i.start-r,r)===u+" ")||(r=u.length,o.substr(i.start-r,r)===u)?(n.setSelection(i.start-r,i.end),n.replaceSelection(f),e=i.start-r):i.start>0&&(s=o.substr(i.start-1,1),!!s&&s!=="\n")?(n.replaceSelection(u+" "+f),e=i.start+u.length+1):(n.replaceSelection(u+" "+f),e=i.start+u.length+1);n.setSelection(e,e+f.length)}};f=function(){var t=n(i.activeElement);n(i).find(".md-editor").each(function(){var i=n(this),u=t.closest(".md-editor")[0]===this,r=i.find("textarea").data("markdown")||i.find('div[data-provider="markdown-preview"]').data("markdown");r&&!u&&r.blur()})};n(i).on("click focusin",function(n){f(n)}).ready(function(){n('textarea[data-provide="markdown"]').markdown({onPreview:function(n,t){t.markdownBody()}})});n(t).on("beforeunload",function(t){var i=r.T("Discard changes?");if(n("body").first().attr("data-page-is-dirty")==="true")return t.returnValue=i,i})})(jQuery,window,document);